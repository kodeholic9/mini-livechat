<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>mini-livechat — E2E Test Client</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Barlow+Condensed:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #0a0c0f;
        --surface: #111418;
        --border: #1e2530;
        --accent: #00e5a0;
        --accent2: #ff6b35;
        --warn: #ffcc00;
        --muted: #3a4455;
        --text: #c8d4e0;
        --text-dim: #5a6a7a;
        --mono: 'Share Tech Mono', monospace;
        --sans: 'Barlow Condensed', sans-serif;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--sans);
        font-size: 14px;
        height: 100vh;
        display: grid;
        grid-template-rows: 48px 1fr;
        overflow: hidden;
      }

      /* ── 헤더 ── */
      header {
        display: flex;
        align-items: center;
        padding: 0 20px;
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        gap: 16px;
      }
      .logo {
        font-family: var(--mono);
        font-size: 13px;
        color: var(--accent);
        letter-spacing: 2px;
        text-transform: uppercase;
      }
      .logo span {
        color: var(--text-dim);
      }
      .status-dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--muted);
        transition: background 0.3s;
        flex-shrink: 0;
      }
      .status-dot.on {
        background: var(--accent);
        box-shadow: 0 0 8px var(--accent);
      }
      .status-dot.err {
        background: var(--accent2);
        box-shadow: 0 0 8px var(--accent2);
      }
      #ws-status {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--text-dim);
        letter-spacing: 1px;
      }
      .header-right {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .badge {
        font-family: var(--mono);
        font-size: 10px;
        padding: 2px 8px;
        border: 1px solid var(--border);
        color: var(--text-dim);
        letter-spacing: 1px;
      }

      /* ── 메인 레이아웃 ── */
      main {
        display: grid;
        grid-template-columns: 260px 1fr 300px;
        overflow: hidden;
      }

      /* ── 공통 패널 ── */
      .panel {
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .panel:last-child {
        border-right: none;
      }
      .panel-title {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 2px;
        color: var(--text-dim);
        padding: 10px 16px;
        border-bottom: 1px solid var(--border);
        text-transform: uppercase;
      }

      /* ── 좌측: 설정 패널 ── */
      .config-panel {
        background: var(--surface);
      }

      .section {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
      }
      .section-label {
        font-family: var(--mono);
        font-size: 9px;
        color: var(--text-dim);
        letter-spacing: 2px;
        text-transform: uppercase;
        margin-bottom: 8px;
      }

      input[type='text'],
      input[type='number'] {
        width: 100%;
        background: var(--bg);
        border: 1px solid var(--border);
        color: var(--text);
        font-family: var(--mono);
        font-size: 12px;
        padding: 7px 10px;
        outline: none;
        transition: border-color 0.2s;
      }
      input[type='text']:focus,
      input[type='number']:focus {
        border-color: var(--accent);
      }
      input[type='text']::placeholder,
      input[type='number']::placeholder {
        color: var(--muted);
      }

      .btn {
        font-family: var(--sans);
        font-weight: 600;
        font-size: 12px;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        padding: 8px 16px;
        border: 1px solid;
        cursor: pointer;
        transition: all 0.15s;
        width: 100%;
        background: transparent;
      }
      .btn-primary {
        border-color: var(--accent);
        color: var(--accent);
      }
      .btn-primary:hover:not(:disabled) {
        background: var(--accent);
        color: var(--bg);
      }
      .btn-danger {
        border-color: var(--accent2);
        color: var(--accent2);
      }
      .btn-danger:hover:not(:disabled) {
        background: var(--accent2);
        color: var(--bg);
      }
      .btn-warn {
        border-color: var(--warn);
        color: var(--warn);
      }
      .btn-warn:hover:not(:disabled) {
        background: var(--warn);
        color: var(--bg);
      }
      .btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      /* ── PTT 버튼 ── */
      .ptt-section {
        padding: 20px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
      }
      #ptt-btn {
        width: 100%;
        height: 72px;
        font-size: 18px;
        font-weight: 700;
        letter-spacing: 3px;
        border-radius: 2px;
        transition: all 0.1s;
        position: relative;
        overflow: hidden;
      }
      #ptt-btn.active {
        background: var(--accent2) !important;
        color: #fff !important;
        border-color: var(--accent2) !important;
        box-shadow: 0 0 20px rgba(255, 107, 53, 0.4);
      }
      #ptt-btn.active::after {
        content: '';
        position: absolute;
        inset: 0;
        background: rgba(255, 255, 255, 0.08);
        animation: pulse 0.8s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
      }

      .audio-meter {
        width: 100%;
        height: 4px;
        background: var(--border);
        position: relative;
        overflow: hidden;
      }
      .audio-meter-fill {
        height: 100%;
        background: var(--accent);
        width: 0%;
        transition: width 0.05s;
      }

      /* ── 중앙: 로그 패널 ── */
      .log-panel {
        background: var(--bg);
      }
      .log-area {
        flex: 1;
        overflow-y: scroll;
        min-height: 0;
        padding: 12px;
        font-family: var(--mono);
        font-size: 11px;
        line-height: 1.8;
      }
      .log-entry {
        display: flex;
        gap: 10px;
        padding: 2px 0;
        border-bottom: 1px solid rgba(30, 37, 48, 0.5);
      }
      .log-time {
        color: var(--text-dim);
        flex-shrink: 0;
        width: 60px;
      }
      .log-dir {
        flex-shrink: 0;
        width: 18px;
        text-align: center;
      }
      .log-dir.in {
        color: var(--accent);
      }
      .log-dir.out {
        color: var(--accent2);
      }
      .log-dir.sys {
        color: var(--warn);
      }
      .log-body {
        flex: 1;
        word-break: break-all;
        color: var(--text);
      }
      .log-body.err {
        color: var(--accent2);
      }
      .log-body.ok {
        color: var(--accent);
      }

      /* 채팅 입력 */
      .chat-input-area {
        padding: 12px;
        border-top: 1px solid var(--border);
        display: flex;
        gap: 8px;
      }
      .chat-input-area input {
        flex: 1;
      }
      .chat-input-area .btn {
        width: auto;
        padding: 8px 14px;
      }

      /* ── 우측: 상태 패널 ── */
      .state-panel {
        background: var(--surface);
      }
      .state-section {
        padding: 12px 16px;
        border-bottom: 1px solid var(--border);
      }
      .state-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
        font-size: 12px;
      }
      .state-key {
        font-family: var(--mono);
        font-size: 10px;
        color: var(--text-dim);
        letter-spacing: 1px;
      }
      .state-val {
        font-family: var(--mono);
        font-size: 11px;
        color: var(--text);
        text-align: right;
        max-width: 160px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      .state-val.ok {
        color: var(--accent);
      }
      .state-val.err {
        color: var(--accent2);
      }
      .state-val.warn {
        color: var(--warn);
      }

      /* 멤버 목록 */
      .member-list {
        overflow-y: auto;
        flex: 1;
        padding: 8px 0;
      }
      .member-item {
        padding: 8px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid rgba(30, 37, 48, 0.5);
      }
      .member-avatar {
        width: 28px;
        height: 28px;
        background: var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--mono);
        font-size: 10px;
        color: var(--accent);
        flex-shrink: 0;
      }
      .member-info {
        flex: 1;
      }
      .member-name {
        font-weight: 600;
        font-size: 13px;
      }
      .member-ssrc {
        font-family: var(--mono);
        font-size: 9px;
        color: var(--text-dim);
      }
      .member-speaking {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--muted);
      }
      .member-speaking.on {
        background: var(--accent2);
        box-shadow: 0 0 6px var(--accent2);
      }

      /* SDP 뷰어 */
      .sdp-viewer {
        padding: 10px 12px;
        font-family: var(--mono);
        font-size: 9px;
        color: var(--text-dim);
        background: var(--bg);
        overflow-y: auto;
        max-height: 140px;
        line-height: 1.6;
        white-space: pre-wrap;
        word-break: break-all;
        border-top: 1px solid var(--border);
      }

      /* 스크롤바 */
      ::-webkit-scrollbar {
        width: 4px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--border);
      }
      ::-webkit-scrollbar-thumb:hover {
        background: var(--muted);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .log-entry {
        animation: fadeIn 0.15s ease-out;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 6px;
      }
      .mt4 {
        margin-top: 4px;
      }
      .mt8 {
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">mini<span>-</span>livechat <span>// E2E</span></div>
      <div class="status-dot" id="dot"></div>
      <div id="ws-status">DISCONNECTED</div>
      <div class="header-right">
        <div class="badge" id="hb-badge">HB: —</div>
        <div class="badge" id="ice-badge">ICE: —</div>
        <div class="badge" id="dtls-badge">DTLS: —</div>
      </div>
    </header>

    <main>
      <div class="panel config-panel">
        <div class="panel-title">// config</div>

        <div class="section">
          <div class="section-label">서버</div>
          <input
            type="text"
            id="srv-url"
            value="ws://localhost:8080/ws"
            placeholder="ws://..."
          />
        </div>

        <div class="section">
          <div class="section-label">인증</div>
          <div style="display:flex; gap:6px; margin-bottom:6px;">
            <input
              type="text"
              id="user-id"
              placeholder="user_id"
              style="flex:1"
            />
            <button
              class="btn btn-primary"
              id="btn-gen-id"
              title="랜덤 ID 생성"
              style="width:36px; padding:0; font-size:16px; flex-shrink:0"
            >↻</button>
          </div>
          <input
            type="text"
            id="token"
            value="changeme-secret"
            placeholder="token"
            style="margin-bottom: 6px"
          />
          <input
            type="number"
            id="priority"
            value="100"
            min="0"
            max="255"
            placeholder="priority (0-255)"
            title="Floor Control 우선순위 — 높을수록 우선 (Emergency=255)"
          />
        </div>

        <div class="section">
          <div class="grid-2">
            <button class="btn btn-primary" id="btn-connect">CONNECT</button>
            <button class="btn btn-danger" id="btn-disconnect" disabled>
              DISC
            </button>
          </div>
          <div class="mt4">
            <button class="btn btn-primary" id="btn-identify" disabled>
              IDENTIFY
            </button>
          </div>
        </div>

        <div class="section">
          <div class="section-label">채널 선택</div>
          <select
            id="channel-select"
            disabled
            style="
              width: 100%;
              background: var(--bg);
              border: 1px solid var(--border);
              color: var(--text);
              font-family: var(--mono);
              font-size: 11px;
              padding: 7px 10px;
              outline: none;
              margin-bottom: 6px;
              cursor: pointer;
            "
          >
            <option value="">— 채널을 선택하세요 —</option>
          </select>
          <div class="grid-2 mt4">
            <button class="btn btn-primary" id="btn-refresh" disabled>↺ LIST</button>
            <button class="btn btn-primary" id="btn-join" disabled>JOIN</button>
          </div>
          <div class="mt4">
            <button class="btn btn-danger" id="btn-leave" disabled>LEAVE</button>
          </div>
        </div>

        <div class="section">
          <div class="section-label">채널 생성</div>
          <input
            type="text"
            id="ch-freq"
            placeholder="주파수 (4자리, 예: 0312)"
            maxlength="4"
            style="margin-bottom: 6px"
          />
          <input
            type="text"
            id="ch-name"
            placeholder="채널명 (이모지 가능)"
            style="margin-bottom: 6px"
          />
          <input
            type="text"
            id="ch-id"
            placeholder="channel_id (예: CH_0312)"
            style="margin-bottom: 6px"
          />
          <button class="btn btn-primary" id="btn-create" disabled>CREATE</button>
        </div>

        <div class="ptt-section">
          <div class="section-label">PTT (Push-To-Talk)</div>
          <button class="btn btn-warn" id="ptt-btn" disabled>
            ● PUSH TO TALK
          </button>
          <div class="audio-meter">
            <div class="audio-meter-fill" id="meter-fill"></div>
          </div>
          <div
            style="
              font-family: var(--mono);
              font-size: 9px;
              color: var(--text-dim);
              text-align: center;
            "
            id="media-state"
          >
            미디어 비활성
          </div>
        </div>

        <div style="flex: 1"></div>
        <div class="section">
          <button
            class="btn btn-primary"
            id="btn-clear"
            style="font-size: 10px"
          >
            CLEAR LOG
          </button>
        </div>
      </div>

      <div class="panel log-panel">
        <div class="panel-title">// protocol log</div>
        <div class="log-area" id="log-area"></div>
        <div class="chat-input-area">
          <input
            type="text"
            id="chat-input"
            placeholder="채팅 메시지 입력..."
            disabled
          />
          <button class="btn btn-primary" id="btn-send" disabled>SEND</button>
        </div>
      </div>

      <div class="panel state-panel">
        <div class="panel-title">// state</div>

        <div class="state-section">
          <div class="state-row">
            <span class="state-key">WS</span
            ><span class="state-val" id="s-ws">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">USER</span
            ><span class="state-val" id="s-user">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">CHANNEL</span
            ><span class="state-val" id="s-channel">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">SSRC</span
            ><span class="state-val" id="s-ssrc">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">ICE</span
            ><span class="state-val" id="s-ice">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">DTLS</span
            ><span class="state-val" id="s-dtls">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">SRTP</span
            ><span class="state-val" id="s-srtp">—</span>
          </div>
          <div
            class="state-row"
            style="
              border-top: 1px solid var(--border);
              margin-top: 6px;
              padding-top: 6px;
            "
          >
            <span class="state-key">FLOOR</span
            ><span class="state-val" id="s-floor">IDLE</span>
          </div>
          <div class="state-row">
            <span class="state-key">HOLDER</span
            ><span class="state-val" id="s-holder">—</span>
          </div>
          <div class="state-row">
            <span class="state-key">QUEUE</span
            ><span class="state-val" id="s-queue">—</span>
          </div>
        </div>

        <div class="panel-title" style="border-top: none">// members</div>
        <div class="member-list" id="member-list"></div>

        <div class="panel-title" style="margin-top: auto">// sdp answer</div>
        <div class="sdp-viewer" id="sdp-viewer">—</div>
      </div>
    </main>

    <script src="app.js"></script>
  </body>
</html>
